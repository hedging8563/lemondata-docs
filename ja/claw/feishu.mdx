---
title: "Feishu / Lark"
description: "WebSocketイベントを使用して、ClawインスタンスをFeishu (Lark) に接続します"
---

Feishu (飞书) またはLarkをClawインスタンスに接続します。WebSocketモードを使用するため、公開コールバックURLは不要です。

## 前提条件

- 開発者アクセス権限を持つ [Feishu](https://www.feishu.cn/) または [Lark](https://www.larksuite.com/) アカウント
- Clawインスタンス ([こちらで作成](https://lemondata.cc/dashboard/claw))

## セットアップガイド

<Steps>
  <Step title="Feishuアプリの作成">
    1. [Feishuオープンプラットフォーム](https://open.feishu.cn/app) (または [Lark Developer](https://open.larksuite.com/app)) にアクセスします
    2. **カスタムアプリを作成** をクリックします
    3. アプリ名と説明を入力します
    4. **作成** をクリックします
  </Step>
  <Step title="ボット機能の追加">
    1. アプリ設定で、**機能** → **ボット** に移動します
    2. ボット機能を有効にします
    3. これにより、アプリでメッセージの送受信が可能になります
  </Step>
  <Step title="認証情報の取得">
    1. **認証情報と基本情報** に移動します
    2. **App ID** (`cli_` で始まるもの) をコピーします
    3. **App Secret** をコピーします
  </Step>
  <Step title="イベント購読の設定">
    1. **イベント購読** に移動します
    2. **WebSocket** モードを選択します (推奨 — 公開URLは不要です)
    3. プロンプトが表示されたら、**Encrypt Key** と **Verification Token** を設定します

    <Tip>
    LemonDataダッシュボードでFeishuを設定すると、Encrypt KeyとVerification Tokenが**自動生成**されます。これらの値をFeishuデベロッパーコンソールにコピーしてください。
    </Tip>
  </Step>
  <Step title="イベント権限の追加">
    1. イベント購読の下で、以下のイベントを追加します:
       - `im.message.receive_v1` — メッセージの受信
    2. **権限とスコープ** に移動し、以下を追加します:
       - `im:message` — メッセージの送受信
       - `im:message.group_at_msg` — グループ内での@メンションの受信
    3. **保存** をクリックします
  </Step>
  <Step title="アプリの公開">
    1. **アプリのリリース** → **バージョン管理** に移動します
    2. 新しいバージョンを作成します
    3. レビューを申請します (社内アプリの場合、通常は即座に完了します)
    4. 承認されると、アプリが有効になります
  </Step>
  <Step title="LemonDataダッシュボードでの設定">
    1. [Clawダッシュボード](https://lemondata.cc/dashboard/claw) にアクセスします
    2. インスタンスの **設定アイコン** をクリックします
    3. **IM連携** タブを開きます
    4. **Feishu** セクションを展開します
    5. **App ID** と **App Secret** を貼り付けます
    6. 自動生成された **Encrypt Key** と **Verification Token** をFeishuデベロッパーコンソールにコピーして戻します
    7. **保存** をクリックします
  </Step>
  <Step title="チャットの開始">
    1. Feishuで、ボットを名前で検索します
    2. メッセージを送信します
    3. ペアリングプロセスを完了します
    4. AIとのチャットを開始しましょう！
  </Step>
</Steps>

## グループ設定

ダッシュボードの **IM連携** タブでグループチャットの動作を設定します：

| 設定 | オプション | 説明 |
|---------|---------|-------------|
| **Group Policy** | Open（デフォルト）/ Allowlist / Disabled | グループ内でボットをトリガーできるユーザーを制御します |
| **Require @mention** | On / Off | @メンションされた場合のみボットが応答します |
| **Group IDs** | チャットIDのリスト | 特定のグループに制限します（空 = すべてのグループ） |
| **Group Allowed Users** | Open IDのリスト | これらのユーザーのみがボットをトリガーできます（allowlistモード） |

## トラブルシューティング

<AccordionGroup>
  <Accordion title="ボットがメッセージを受信しない">
    - アプリが公開され、承認されているか確認してください
    - `im.message.receive_v1` イベントが購読されているか確認してください
    - HTTPではなく WebSocket モードが選択されていることを確認してください
    - FeishuコンソールとClaw設定の間で Encrypt Key と Verification Token が一致しているか確認してください
  </Accordion>
  <Accordion title="'app_ticket' エラー">
    - これは通常、App ID または App Secret が正しくないことを意味します
    - ダッシュボードの認証情報を再確認してください
  </Accordion>
</AccordionGroup>