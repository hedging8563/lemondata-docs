---
title: "飛書 / Lark"
description: "使用 WebSocket 事件將您的 Claw 實例連接到飛書 (Lark)"
---

將飛書 (Feishu) 或 Lark 連接到您的 Claw 實例。使用 WebSocket 模式 — 無需公開的回調 URL。

## 先決條件

- 一個具有開發者權限的 [Feishu](https://www.feishu.cn/) 或 [Lark](https://www.larksuite.com/) 帳號
- 一個 Claw 實例 ([在此處建立](https://lemondata.cc/dashboard/claw))

## 設定指南

<Steps>
  <Step title="建立飛書應用程式">
    1. 前往 [飛書開放平台](https://open.feishu.cn/app) (或 [Lark Developer](https://open.larksuite.com/app))
    2. 點擊 **建立自定義應用**
    3. 輸入應用程式名稱和描述
    4. 點擊 **建立**
  </Step>
  <Step title="添加機器人能力">
    1. 在您的應用程式設定中，前往 **添加能力** → **機器人**
    2. 啟用機器人能力
    3. 這允許您的應用程式接收和發送訊息
  </Step>
  <Step title="獲取憑證">
    1. 前往 **憑證與基礎資訊**
    2. 複製 **App ID** (以 `cli_` 開頭)
    3. 複製 **App Secret**
  </Step>
  <Step title="配置事件訂閱">
    1. 前往 **事件訂閱**
    2. 選擇 **WebSocket** 模式 (推薦 — 無需公開 URL)
    3. 如果出現提示，請設置 **Encrypt Key** 和 **Verification Token**

    <Tip>
    當您在 LemonData 控制面板中配置飛書時，**Encrypt Key** 和 **Verification Token** 會為您自動生成。請將這些值複製到飛書開發者後台。
    </Tip>
  </Step>
  <Step title="添加事件權限">
    1. 在事件訂閱下，添加以下事件：
       - `im.message.receive_v1` — 接收訊息
    2. 前往 **權限管理** 並添加：
       - `im:message` — 發送和接收訊息
       - `im:message.group_at_msg` — 接收群組 @ 提及
    3. 點擊 **儲存**
  </Step>
  <Step title="發佈應用程式">
    1. 前往 **應用發佈** → **版本管理與發佈**
    2. 建立新版本
    3. 提交審核 (對於企業自建應用，這通常是即時的)
    4. 審核通過後，應用程式即正式上線
  </Step>
  <Step title="在 LemonData 控制面板中配置">
    1. 前往您的 [Claw 控制面板](https://lemondata.cc/dashboard/claw)
    2. 點擊您實例上的 **設定圖示**
    3. 打開 **IM 整合** 頁籤
    4. 展開 **飛書** 區塊
    5. 貼上您的 **App ID** 和 **App Secret**
    6. 將自動生成的 **Encrypt Key** 和 **Verification Token** 複製回飛書開發者後台
    7. 點擊 **儲存**
  </Step>
  <Step title="開始聊天">
    1. 在飛書中，按名稱搜尋您的機器人
    2. 向它發送訊息
    3. 第一個使用者將 **自動配對** 為所有者 — 無需程式碼！
    4. 開始與 AI 聊天！
  </Step>
</Steps>

## 群組設定

在控制面板的 **IM 整合** 頁籤中配置群組聊天行為：

| 設定 | 選項 | 描述 |
|---------|---------|-------------|
| **群組策略** | 開放 (預設) / 白名單 / 已停用 | 控制誰可以在群組中觸發機器人 |
| **需要 @提及** | 開啟 / 關閉 | 機器人僅在被 @提及時回應 |
| **群組 ID** | 對話 ID 列表 | 限制於特定群組 (留空 = 所有群組) |
| **群組允許的使用者** | Open ID 列表 | 僅這些使用者可以觸發機器人 (白名單模式) |

## 疑難排解

<AccordionGroup>
  <Accordion title="機器人收不到訊息">
    - 驗證應用程式已發佈並通過審核
    - 檢查是否已訂閱 `im.message.receive_v1` 事件
    - 確保選擇了 WebSocket 模式 (而非 HTTP)
    - 驗證飛書後台與 Claw 配置之間的 Encrypt Key 和 Verification Token 是否一致
  </Accordion>
  <Accordion title="'app_ticket' 錯誤">
    - 這通常意味著 App ID 或 App Secret 不正確
    - 請再次檢查控制面板中的憑證
  </Accordion>
</AccordionGroup>