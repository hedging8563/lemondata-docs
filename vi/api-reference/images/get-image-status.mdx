---
title: "Lấy trạng thái hình ảnh"
openapi: "GET /v1/images/generations/{task_id}"
description: "Lấy trạng thái và kết quả của tác vụ tạo hình ảnh bất đồng bộ"
---

## Tham số đường dẫn

<ParamField path="task_id" type="string" required>
  ID tác vụ được trả về từ yêu cầu tạo hình ảnh ban đầu.
</ParamField>

## Phản hồi

<ResponseField name="created" type="integer">
  Dấu thời gian Unix khi tạo.
</ResponseField>

<ResponseField name="task_id" type="string">
  Mã định danh tác vụ.
</ResponseField>

<ResponseField name="status" type="string">
  Trạng thái tác vụ: `pending`, `processing`, `completed`, hoặc `failed`.
</ResponseField>

<ResponseField name="data" type="array">
  Mảng các hình ảnh đã tạo (được điền khi `status` là `completed`).

  Mỗi đối tượng chứa:
  - `url` (string): URL của hình ảnh đã tạo
  - `revised_prompt` (string): Prompt đã sử dụng để tạo
</ResponseField>

<ResponseField name="error" type="string">
  Thông báo lỗi (chỉ xuất hiện khi `status` là `failed`).
</ResponseField>

<RequestExample>
```bash cURL
curl "https://api.lemondata.cc/v1/images/generations/img_abc123def456" \
  -H "Authorization: Bearer sk-your-api-key"
```

```python Python
import requests

response = requests.get(
    "https://api.lemondata.cc/v1/images/generations/img_abc123def456",
    headers={"Authorization": "Bearer sk-your-api-key"}
)

data = response.json()
print(f"Status: {data['status']}")

if data["status"] == "completed":
    print(f"Image URL: {data['data'][0]['url']}")
```

```javascript JavaScript
const response = await fetch(
  'https://api.lemondata.cc/v1/images/generations/img_abc123def456',
  {
    headers: {
      'Authorization': 'Bearer sk-your-api-key'
    }
  }
);

const data = await response.json();
console.log(`Status: ${data.status}`);

if (data.status === 'completed') {
  console.log(`Image URL: ${data.data[0].url}`);
}
```
</RequestExample>

<ResponseExample>
```json Đang chờ
{
  "created": 1706000000,
  "task_id": "img_abc123def456",
  "status": "pending",
  "data": [
    {
      "url": "",
      "revised_prompt": "a beautiful sunset over mountains"
    }
  ]
}
```

```json Hoàn thành
{
  "created": 1706000000,
  "task_id": "img_abc123def456",
  "status": "completed",
  "data": [
    {
      "url": "https://cdn.example.com/generated/image-abc123.png",
      "revised_prompt": "a beautiful sunset over mountains with vibrant orange and purple colors"
    }
  ]
}
```

```json Thất bại
{
  "created": 1706000000,
  "task_id": "img_abc123def456",
  "status": "failed",
  "error": "Content policy violation",
  "data": []
}
```
</ResponseExample>

## Thực hành tốt nhất khi Polling

<Tip>
**Khoảng thời gian polling khuyến nghị**: 3-5 giây. Hầu hết các tác vụ tạo hình ảnh hoàn thành trong vòng 30-120 giây tùy thuộc vào mô hình.
</Tip>

```python
import requests
import time

def poll_image_task(task_id, api_key, max_wait=300, interval=3):
    """Polling kết quả tạo hình ảnh với timeout."""
    url = f"https://api.lemondata.cc/v1/images/generations/{task_id}"
    headers = {"Authorization": f"Bearer {api_key}"}

    start_time = time.time()
    while time.time() - start_time < max_wait:
        response = requests.get(url, headers=headers)
        data = response.json()

        if data["status"] == "completed":
            return data["data"][0]["url"]
        elif data["status"] == "failed":
            raise Exception(data.get("error", "Generation failed"))

        time.sleep(interval)

    raise TimeoutError(f"Task {task_id} did not complete within {max_wait}s")

# Sử dụng
image_url = poll_image_task("img_abc123def456", "sk-your-api-key")
print(f"Generated image: {image_url}")
```
