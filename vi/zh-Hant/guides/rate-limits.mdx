---
title: "Giới hạn tốc độ"
description: "Tìm hiểu và xử lý giới hạn tốc độ"
---

## Tổng quan

LemonData áp dụng giới hạn tốc độ để đảm bảo tính công bằng khi sử dụng và sự ổn định của nền tảng. Các giới hạn sẽ khác nhau tùy thuộc vào cấp độ tài khoản.

## Các cấp độ giới hạn tốc độ

| Cấp độ | Số yêu cầu/phút | Mô tả |
|------|-------------|-------------|
| **User** | 1,000 | Cấp độ mặc định cho tất cả tài khoản |
| **Partner** | 3,000 | Dành cho các đối tác tích hợp |
| **VIP** | 10,000 | Người dùng có lưu lượng truy cập cao |

<Note>
  Giới hạn tốc độ có thể thay đổi. Vui lòng liên hệ support@lemondata.cc để yêu cầu giới hạn tùy chỉnh.
</Note>

## Header giới hạn tốc độ

Mỗi phản hồi API đều bao gồm thông tin về giới hạn tốc độ:

```
X-RateLimit-Limit: 60          # Giới hạn của bạn mỗi phút
X-RateLimit-Remaining: 55      # Số yêu cầu còn lại
X-RateLimit-Reset: 1234567890  # Dấu thời gian Unix khi giới hạn được đặt lại
```

## Đã vượt quá giới hạn tốc độ

Khi bạn vượt quá giới hạn, bạn sẽ nhận được phản hồi `429`:

```json
{
  "error": {
    "message": "Rate limit exceeded. Please slow down.",
    "type": "rate_limit_exceeded"
  }
}
```

Kèm theo header bổ sung:
```
Retry-After: 60  # Số giây cần chờ trước khi thử lại
```

## Xử lý giới hạn tốc độ

### Exponential Backoff (Lùi bước theo cấp số nhân)

Triển khai exponential backoff để tự động thử lại:

```python
import time
from openai import OpenAI, RateLimitError

client = OpenAI(
    api_key="sk-your-api-key",
    base_url="https://api.lemondata.cc/v1"
)

def make_request_with_backoff(messages, max_retries=5):
    for attempt in range(max_retries):
        try:
            return client.chat.completions.create(
                model="gpt-4o",
                messages=messages
            )
        except RateLimitError as e:
            if attempt == max_retries - 1:
                raise

            wait_time = 2 ** attempt  # 1, 2, 4, 8, 16 giây
            print(f"Bị giới hạn tốc độ. Đang chờ {wait_time} giây...")
            time.sleep(wait_time)
```

### Hàng đợi yêu cầu

Đối với các ứng dụng có lưu lượng cao, hãy triển khai hàng đợi yêu cầu:

```python
import asyncio
from collections import deque

class RateLimitedClient:
    def __init__(self, requests_per_minute=60):
        self.rpm = requests_per_minute
        self.interval = 60 / requests_per_minute
        self.last_request = 0

    async def request(self, messages):
        # Chờ nếu cần thiết để tuân thủ giới hạn tốc độ
        now = asyncio.get_event_loop().time()
        wait_time = max(0, self.last_request + self.interval - now)
        if wait_time > 0:
            await asyncio.sleep(wait_time)

        self.last_request = asyncio.get_event_loop().time()
        return await self.client.chat.completions.create(
            model="gpt-4o",
            messages=messages
        )
```

### Xử lý theo lô

Đối với các hoạt động số lượng lớn, hãy sử dụng xử lý theo lô với độ trễ:

```python
def process_batch(items, batch_size=50, delay=1):
    results = []
    for i in range(0, len(items), batch_size):
        batch = items[i:i + batch_size]
        for item in batch:
            result = client.chat.completions.create(
                model="gpt-4o",
                messages=[{"role": "user", "content": item}]
            )
            results.append(result)
        time.sleep(delay)  # Tạm dừng giữa các lô
    return results
```

## Thực hành tốt nhất

<AccordionGroup>
  <Accordion title="Theo dõi mức độ sử dụng của bạn">
    Theo dõi các header giới hạn tốc độ để chủ động duy trì trong phạm vi cho phép.
  </Accordion>

  <Accordion title="Triển khai bộ nhớ đệm">
    Lưu bộ nhớ đệm các phản hồi cho các yêu cầu giống nhau để giảm số lượng gọi API.
  </Accordion>

  <Accordion title="Sử dụng mô hình phù hợp">
    Các mô hình nhanh hơn (như gpt-4o-mini) cung cấp thông lượng cao hơn.
  </Accordion>

  <Accordion title="Liên hệ với chúng tôi để có giới hạn cao hơn">
    Nếu bạn cần giới hạn cao hơn, vui lòng liên hệ support@lemondata.cc.
  </Accordion>
</AccordionGroup>

## Nâng cấp cấp độ của bạn

Để yêu cầu nâng cấp cấp độ:

1. Đăng nhập vào [Bảng điều khiển](https://lemondata.cc/dashboard)
2. Đi tới **Settings → Account**
3. Liên hệ với đội ngũ hỗ trợ và giải thích trường hợp sử dụng của bạn

Hoặc gửi email đến support@lemondata.cc và cung cấp:
- Email tài khoản của bạn
- Lưu lượng yêu cầu dự kiến
- Mô tả trường hợp sử dụng