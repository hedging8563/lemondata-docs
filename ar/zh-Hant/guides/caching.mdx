---
title: "✨ التخزين المؤقت الذكي"
description: "تقليل التكاليف وزمن الاستجابة من خلال التخزين المؤقت الدلالي المدرك للسياق"
---

## نظرة عامة

يوفر LemonData نظام تخزين مؤقت ذكي يقلل بشكل كبير من تكاليف API وزمن استجابة الطلبات. لا يقتصر التخزين المؤقت لدينا على مطابقة الطلبات البسيطة فحسب، بل يفهم أيضًا **المعنى الدلالي (semantic meaning)** للمطالبات (prompts) الخاصة بك.

<CardGroup cols={2}>
  <Card title="توفير التكاليف" icon="piggy-bank">
    يتم احتساب ضربات التخزين المؤقت (Cache hits) بجزء بسيط فقط من التكلفة العادية.
  </Card>
  <Card title="استجابة أسرع" icon="bolt">
    يتم إرجاع الاستجابات المخزنة مؤقتًا على الفور دون الحاجة إلى إجراء استنتاج النموذج.
  </Card>
  <Card title="إدراك السياق" icon="brain">
    تجد المطابقة الدلالية طلبات مماثلة حتى لو كانت الصياغة مختلفة.
  </Card>
  <Card title="التحكم في الخصوصية" icon="shield">
    تحكم كامل في المحتوى المخزن مؤقتًا والمشارك.
  </Card>
</CardGroup>

## كيفية العمل

يستخدم LemonData نظام تخزين مؤقت ثنائي الطبقات:

### الطبقة الأولى: التخزين المؤقت للاستجابة (مطابقة دقيقة)

بالنسبة للطلبات الحتمية (`temperature=0`)، نقوم بتخزين الاستجابة الدقيقة مؤقتًا:

- **شروط المطابقة**: نفس النموذج والرسائل والمعلمات
- **السرعة**: فوري (بالميكروثانية)
- **مناسب لـ**: الاستعلامات المتكررة المتطابقة

### الطبقة الثانية: التخزين المؤقت الدلالي (مطابقة التشابه)

بالنسبة لجميع الطلبات، نتحقق أيضًا من التشابه الدلالي باستخدام خوارزمية مطابقة ثنائية المراحل:

- **المرحلة الأولى (الاستعلام فقط)**: تشابه استعلام المستخدم ≥95%
- **المرحلة الثانية (السياق الكامل)**: التشابه بما في ذلك سياق المحادثة ≥85%
- **مناسب لـ**: استعلامات FAQ، والأسئلة الشائعة

```
User A: "What is the capital of France?"
User B: "Tell me the capital city of France"
→ Same cached response (high semantic similarity)
```

## التحكم في التخزين المؤقت

### التحكم على مستوى الطلب

استخدم المعلمة `cache_control` في جسم الطلب للتحكم في سلوك التخزين المؤقت لكل طلب:

```bash
# 跳過快取查詢，始終呼叫模型
curl https://api.lemondata.cc/v1/chat/completions \
  -H "Authorization: Bearer sk-your-key" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "Hello"}],
    "cache_control": {"type": "no_cache"}
  }'
```

| النوع | التأثير |
|------|------|
| `no_cache` | تخطي البحث في التخزين المؤقت والحصول دائمًا على استجابة جديدة |
| `no_store` | عدم تخزين هذه الاستجابة في التخزين المؤقت |
| `response_only` | استخدام التخزين المؤقت للمطابقة الدقيقة فقط (تخطي التخزين المؤقت الدلالي) |
| `semantic_only` | استخدام التخزين المؤقت الدلالي فقط (تخطي المطابقة الدقيقة) |

### رؤوس الاستجابة

تحتوي كل استجابة على حالة التخزين المؤقت:

```
X-Cache-Status: HIT    # الاستجابة من التخزين المؤقت
X-Cache-Status: MISS   # استجابة جديدة من النموذج
```

## التحقق من حالة التخزين المؤقت

```python
from openai import OpenAI

client = OpenAI(
    api_key="sk-your-key",
    base_url="https://api.lemondata.cc/v1"
)

response = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": "What is 2+2?"}]
)

# 從回應標頭檢查快取狀態
# (在原始 HTTP 回應中可用)
print(f"Cache: {response._raw_response.headers.get('X-Cache-Status')}")
```

## فوترة التخزين المؤقت

تكلفة ضربات التخزين المؤقت أقل بكثير من الطلبات الجديدة:

| النوع | التكلفة |
|------|------|
| ضربة تخزين مؤقت (HIT) | **خصم 80%** |
| فقدان التخزين المؤقت (MISS) | السعر الأصلي |

يظهر الخصم الدقيق في سجلات الاستخدام بلوحة التحكم الخاصة بك.

## التحكم في الخصوصية

### مستوى المؤسسة / المستخدم

تكوين سلوك التخزين المؤقت في إعدادات لوحة التحكم:

| الوضع | الوصف |
|------|-------------|
| **مشترك (Shared)** | تمكين التخزين المؤقت، قد تتم مشاركة الاستجابات عبر المستخدمين (افتراضي للحسابات الشخصية) |
| **معزول (Isolated)** | تمكين التخزين المؤقت، لكن الاستجابات تقتصر على مؤسستك فقط (افتراضي لحسابات المؤسسات) |
| **معطل (Disabled)** | عدم استخدام التخزين المؤقت على الإطلاق |

عناصر أخرى قابلة للتكوين:
- **عتبة التشابه**: ضبط حساسية المطابقة الدلالية (الافتراضي: 92%)
- **TTL مخصص**: تجاوز وقت انتهاء صلاحية التخزين المؤقت
- **استبعاد النماذج**: تعطيل التخزين المؤقت لنماذج محددة

### مستوى الطلب

استخدم المعلمة `cache_control` لتجاوز الإعدادات لطلب واحد:

```bash
# 為此請求停用快取
curl https://api.lemondata.cc/v1/chat/completions \
  -H "Authorization: Bearer sk-your-key" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "..."}],
    "cache_control": {"type": "no_store"}
  }'
```

## ملاحظات التخزين المؤقت

إذا تلقيت استجابة خاطئة من التخزين المؤقت، يمكنك الإبلاغ عنها:

```bash
curl -X POST https://api.lemondata.cc/v1/cache/feedback \
  -H "Authorization: Bearer sk-your-key" \
  -H "Content-Type: application/json" \
  -d '{
    "cache_entry_id": "abc123",
    "feedback_type": "wrong_answer",
    "description": "Response was outdated"
  }'
```

**أنواع الملاحظات:**
- `wrong_answer` - خطأ واقعي
- `outdated` - معلومات قديمة
- `irrelevant` - غير ذي صلة بالسؤال
- `other` - مشاكل أخرى

عندما يتلقى إدخال التخزين المؤقت ما يكفي من الملاحظات السلبية، سيتم إبطاله تلقائيًا.

## أفضل الممارسات

<AccordionGroup>
  <Accordion title="استخدم temperature=0 للاستعلامات القابلة للتخزين مؤقتًا">
    تؤدي الإعدادات الحتمية إلى زيادة معدل ضربات التخزين المؤقت.
  </Accordion>

  <Accordion title="توحيد تنسيق المطالبات">
    يؤدي التنسيق المتسق إلى تحسين المطابقة الدلالية.
  </Accordion>

  <Accordion title="استخدم no-cache للاستعلامات الحساسة للوقت">
    يجب أن تتخطى الأحداث الجارية والبيانات في الوقت الفعلي التخزين المؤقت.
  </Accordion>

  <Accordion title="مراقبة معدل ضربات التخزين المؤقت">
    عرض إحصائيات التخزين المؤقت والمبالغ الموفرة في لوحة التحكم.
  </Accordion>
</AccordionGroup>

## متى لا يجب استخدام التخزين المؤقت

قم بتعطيل التخزين المؤقت للحالات التالية:

- **المعلومات في الوقت الفعلي**: أسعار الأسهم، الطقس، الأخبار
- **المحتوى المخصص**: التوصيات الخاصة بمستخدم معين
- **المهام الإبداعية**: عندما يكون التنوع مطلوبًا
- **البيانات الحساسة**: المعلومات السرية

```python
# 對於時間敏感的查詢
response = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": "What's the current stock price of AAPL?"}],
    extra_body={"cache_control": {"type": "no_cache"}}
)
```