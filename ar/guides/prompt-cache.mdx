---
title: "✨ ذاكرة التخزين المؤقت للمطالبات من المزود"
description: "تعرف على التخزين المؤقت للمطالبات على مستوى المزود وكيف يقلل التكاليف"
---

## نظرة عامة

بالإضافة إلى [التخزين المؤقت الدلالي للمنصة](/guides/caching) الخاص بـ LemonData، يقدم العديد من مزودي الذكاء الاصطناعي ميزة **التخزين المؤقت للمطالبات** الخاصة بهم. هذه آلية تخزين مؤقت منفصلة تعمل على مستوى المزود (Anthropic، OpenAI، DeepSeek، إلخ).

<Note>
**نوعان من التخزين المؤقت**

| النوع | المكان | آلية العمل | التكلفة |
|------|-------|--------------|------|
| **التخزين المؤقت للمنصة** | LemonData | مطابقة التشابه الدلالي | 10% من السعر العادي |
| **التخزين المؤقت للمزود** | المصدر (Anthropic/OpenAI/إلخ) | مطابقة البادئة الدقيقة | أسعار مخفضة للـ tokens |

هذان النوعان **متنافيان**: إذا حدثت إصابة في التخزين المؤقت للمنصة، فلن يتم إجراء استدعاء للمصدر، وبالتالي لا ينطبق التخزين المؤقت للمزود.
</Note>

## كيف يعمل التخزين المؤقت للمطالبات لدى المزود

يقوم التخزين المؤقت للمطالبات لدى المزود بتخزين التمثيل المعالج لبادئة مطالبتك على خوادم المزود. عندما ترسل طلباً بنفس البادئة، يمكن للمزود تخطي إعادة معالجة تلك الـ tokens.

### الخصائص الرئيسية

- **يعتمد على البادئة**: يمكن تخزين بداية مطالبتك فقط مؤقتاً
- **مطابقة دقيقة**: يتطلب tokens متطابقة تماماً (وليس تشابهاً دلالياً)
- **محدد بوقت**: تنتهي صلاحية مدخلات التخزين المؤقت (عادةً من 5 إلى 60 دقيقة)
- **تلقائي**: لا يلزم إجراء تكوين خاص

```
الطلب 1: [System prompt + Context A + Question 1]
          ^^^^^^^^^^^^^^^^^^^^^^^^
          يتم تخزين هذه البادئة مؤقتاً

الطلب 2: [System prompt + Context A + Question 2]
          ^^^^^^^^^^^^^^^^^^^^^^^^
          إصابة التخزين المؤقت! تتم معالجة السؤال 2 فقط
```

## المزودون المدعومون

| المزود | خصم قراءة التخزين المؤقت | تكلفة كتابة التخزين المؤقت | الحد الأدنى للـ Tokens |
|----------|---------------------|------------------|------------|
| **Anthropic** | خصم 90% | علاوة 25% | 1024 |
| **OpenAI** | خصم 50% | نفس تكلفة الإدخال | 1024 |
| **DeepSeek** | خصم 90% | نفس تكلفة الإدخال | 64 |
| **Google** | خصم 75% | علاوة 25% | 32768 |

<Info>
يتم تطبيق الخصومات تلقائياً. تقوم LemonData بتمرير أسعار التخزين المؤقت من المزود إليك مباشرة.
</Info>

## تحديد استخدام التخزين المؤقت

### في سجلات الاستخدام

تعرض سجلات الاستخدام الخاصة بك تفصيلاً مفصلاً لـ tokens التخزين المؤقت:

| الحقل | الوصف |
|-------|-------------|
| `cacheReadTokens` | الـ tokens المقدمة من التخزين المؤقت للمزود (مخفضة) |
| `cacheWriteTokens` | الـ tokens المكتوبة في التخزين المؤقت (للطلبات المستقبلية) |
| `nonCachedPromptTokens` | الـ tokens المعالجة بدون تخزين مؤقت |

### في المعاملات

تعرض المعاملات علامة **Provider Cache** عند استخدام التخزين المؤقت من المصدر:

- **Cache** (أزرق سماوي): إصابة التخزين المؤقت الدلالي للمنصة - خصم 90%
- **Provider Cache** (أزرق مخضر): إصابة التخزين المؤقت للمزود - أسعار مخفضة

## مثال على حساب التكلفة

لطلب يحتوي على 10,000 token إدخال إلى Claude (Anthropic):

**بدون تخزين مؤقت:**
```
10,000 tokens × $3.00/1M = $0.030
```

**مع التخزين المؤقت للمزود (8,000 مخزنة مؤقتاً + 2,000 جديدة):**
```
قراءة التخزين المؤقت:  8,000 tokens × $0.30/1M = $0.0024  (خصم 90%)
كتابة التخزين المؤقت: 2,000 tokens × $3.75/1M = $0.0075  (علاوة 25%)
الإجمالي: $0.0099 (توفير 67%)
```

## أفضل الممارسات

<AccordionGroup>
  <Accordion title="استخدم مطالبات نظام متسقة">
    ضع مطالبة النظام والسياق الثابت في بداية رسائلك. هذا يزيد من احتمالية إصابة التخزين المؤقت.
  </Accordion>

  <Accordion title="اجمع الطلبات المتشابهة">
    أرسل الطلبات ذات البادئة المتماثلة بشكل متقارب زمنياً للاستفادة من التخزين المؤقت قبل انتهاء صلاحيته.
  </Accordion>

  <Accordion title="استوفِ الحد الأدنى لمتطلبات الـ tokens">
    تأكد من أن البادئة القابلة للتخزين المؤقت تستوفي الحد الأدنى للمزود (مثلاً 1024 token لـ Anthropic/OpenAI).
  </Accordion>

  <Accordion title="راقب مقاييس التخزين المؤقت">
    تحقق من إحصائيات الاستخدام في لوحة التحكم لمعرفة معدلات إصابة التخزين المؤقت والتوفير.
  </Accordion>
</AccordionGroup>

## التخزين المؤقت للمنصة مقابل التخزين المؤقت للمزود

| الجانب | التخزين المؤقت للمنصة | التخزين المؤقت للمزود |
|--------|----------------|----------------|
| **المطابقة** | التشابه الدلالي | مطابقة البادئة الدقيقة |
| **التكلفة** | 10% من السعر العادي | أسعار مخفضة |
| **زمن الاستجابة** | فوري (~1 مللي ثانية) | مخفض (تخطي المعالجة) |
| **التحكم** | إعدادات لوحة التحكم | تلقائي |
| **النطاق** | عبر المستخدمين (اختياري) | لكل مفتاح API |

### متى ينطبق كل نوع

```
وصول الطلب
    │
    ▼
┌──────────────────────────────────┐
│ إصابة التخزين المؤقت للمنصة؟   │
└──────────────────────────────────┘
    │ نعم                │ لا
    ▼                    ▼
┌──────────┐    ┌──────────────────────────┐
│ إرجاع   │    │ استدعاء API المصدر       │
│ المخزن  │    └──────────────────────────┘
│ (10%)    │            │
└──────────┘            ▼
               ┌──────────────────────────────┐
               │ إصابة التخزين المؤقت للمزود؟ │
               └──────────────────────────────┘
                   │ نعم          │ لا
                   ▼              ▼
               سعر مخفض       السعر الكامل
               للـ tokens      للـ tokens
```

## التحقق من حالة التخزين المؤقت

### رؤوس الاستجابة

```
X-Cache-Status: HIT           # إصابة التخزين المؤقت للمنصة
X-Cache-Status: MISS          # لا يوجد تخزين مؤقت للمنصة
X-Upstream-Cache-Read: 8000   # tokens قراءة التخزين المؤقت للمزود
X-Upstream-Cache-Write: 2000  # tokens كتابة التخزين المؤقت للمزود
```

### واجهة برمجة تطبيقات الاستخدام

استعلم عن سجلات الاستخدام لرؤية تفصيل التخزين المؤقت:

```bash
curl https://api.lemondata.cc/v1/usage/logs \
  -H "Authorization: Bearer sk-your-key" \
  -H "Content-Type: application/json"
```

تتضمن الاستجابة:
```json
{
  "promptTokens": 10000,
  "cacheReadTokens": 8000,
  "cacheWriteTokens": 2000,
  "nonCachedPromptTokens": 0,
  "completionTokens": 500,
  "cost": 0.0099
}
```

## الأسئلة الشائعة

<AccordionGroup>
  <Accordion title="هل يمكنني تعطيل التخزين المؤقت للمزود؟">
    التخزين المؤقت للمزود تلقائي ولا يمكن تعطيله. ومع ذلك، فهو يفيدك فقط (تكاليف أقل)، لذا لا يوجد سبب لتعطيله.
  </Accordion>

  <Accordion title="لماذا لم يصب طلبي التخزين المؤقت للمزود؟">
    الأسباب الشائعة:
    - تغيرت البادئة (حتى اختلاف token واحد)
    - انتهت صلاحية التخزين المؤقت (عادةً من 5 إلى 60 دقيقة)
    - البادئة قصيرة جداً (أقل من الحد الأدنى للـ tokens)
    - تم استخدام مفتاح API مختلف
  </Accordion>

  <Accordion title="هل يدعم BYOK التخزين المؤقت للمزود؟">
    نعم! عند استخدام مفاتيح API الخاصة بك (BYOK)، يعمل التخزين المؤقت للمزود بنفس الطريقة. يرتبط التخزين المؤقت بمفتاح API الخاص بك لدى المصدر.
  </Accordion>

  <Accordion title="كيف أزيد من توفير التخزين المؤقت؟">
    1. استخدم التخزين المؤقت الدلالي للمنصة للاستعلامات المتشابهة المتكررة
    2. نظّم المطالبات بحيث يكون المحتوى الثابت أولاً
    3. حافظ على اتساق مطالبات النظام عبر الطلبات
    4. أرسل الطلبات المتعلقة بشكل متتابع وسريع
  </Accordion>
</AccordionGroup>
