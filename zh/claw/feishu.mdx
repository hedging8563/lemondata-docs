---
title: "飞书 / Lark"
description: "使用 WebSocket 事件将您的 Claw 实例连接到飞书 (Lark)"
---

将飞书 (Feishu) 或 Lark 连接到您的 Claw 实例。使用 WebSocket 模式 —— 无需公共回调 URL。

## 前提条件

- 一个具有开发者权限的 [飞书](https://www.feishu.cn/) 或 [Lark](https://www.larksuite.com/) 账号
- 一个 Claw 实例（[在此创建](https://lemondata.cc/dashboard/claw)）

## 设置指南

<Steps>
  <Step title="创建飞书应用">
    1. 前往 [飞书开放平台](https://open.feishu.cn/app)（或 [Lark 开发者平台](https://open.larksuite.com/app)）
    2. 点击 **创建企业自建应用**
    3. 输入应用名称和描述
    4. 点击 **确定创建**
  </Step>
  <Step title="添加机器人能力">
    1. 在应用设置中，前往 **添加应用能力** → **机器人**
    2. 启用机器人能力
    3. 这将允许您的应用接收和发送消息
  </Step>
  <Step title="获取凭据">
    1. 前往 **凭据与基础信息**
    2. 复制 **App ID**（以 `cli_` 开头）
    3. 复制 **App Secret**
  </Step>
  <Step title="配置事件订阅">
    1. 前往 **事件订阅**
    2. 选择 **WebSocket** 模式（推荐 —— 无需公共 URL）
    3. 如果有提示，设置 **Encrypt Key** 和 **Verification Token**

    <Tip>
    当您在 LemonData 控制面板中配置飞书时，**Encrypt Key** 和 **Verification Token** 会为您自动生成。将这些值复制到飞书开发者后台。
    </Tip>
  </Step>
  <Step title="添加事件权限">
    1. 在“事件订阅”下，添加以下事件：
       - `im.message.receive_v1` — 接收消息
    2. 前往 **权限管理** 并添加：
       - `im:message` — 发送和接收消息
       - `im:message.group_at_msg` — 接收群聊中 @ 消息
    3. 点击 **保存**
  </Step>
  <Step title="发布应用">
    1. 前往 **应用发布** → **版本管理与发布**
    2. 创建新版本
    3. 提交审核（对于企业自建应用，通常是即时的）
    4. 审核通过后，应用即处于启用状态
  </Step>
  <Step title="在 LemonData 控制面板中配置">
    1. 前往您的 [Claw 控制面板](https://lemondata.cc/dashboard/claw)
    2. 点击您实例上的 **设置图标**
    3. 打开 **IM 集成** 选项卡
    4. 展开 **飞书** 部分
    5. 粘贴您的 **App ID** 和 **App Secret**
    6. 将自动生成的 **Encrypt Key** 和 **Verification Token** 复制回飞书开发者后台
    7. 点击 **保存**
  </Step>
  <Step title="开始聊天">
    1. 在飞书中，按名称搜索您的机器人
    2. 向它发送一条消息
    3. 完成配对过程
    4. 开始与 AI 聊天！
  </Step>
</Steps>

## 群组设置

在控制面板的 **IM 集成** 选项卡中配置群聊行为：

| 设置 | 选项 | 描述 |
|---------|---------|-------------|
| **Group Policy** | Open（默认）/ Allowlist / Disabled | 控制谁可以在群组中触发机器人 |
| **Require @mention** | On / Off | 机器人仅在被 @提及时响应 |
| **Group IDs** | 聊天 ID 列表 | 限制为特定群组（留空 = 所有群组） |
| **Group Allowed Users** | Open ID 列表 | 仅这些用户可以触发机器人（allowlist 模式） |

## 故障排除

<AccordionGroup>
  <Accordion title="机器人收不到消息">
    - 确认应用已发布并审核通过
    - 检查是否已订阅 `im.message.receive_v1` 事件
    - 确保选择了 WebSocket 模式（而非 HTTP）
    - 验证飞书后台与 Claw 配置之间的 Encrypt Key 和 Verification Token 是否匹配
  </Accordion>
  <Accordion title="'app_ticket' 错误">
    - 这通常意味着 App ID 或 App Secret 不正确
    - 请仔细检查控制面板中的凭据
  </Accordion>
</AccordionGroup>