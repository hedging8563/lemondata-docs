---
title: "速率限制"
description: "了解并处理速率限制"
---

## 概览

LemonData 实施速率限制以确保公平使用和平台稳定性。限制因账户层级而异。

## 速率限制层级

| 层级 | 请求数/分钟 | 描述 |
|------|-------------|-------------|
| **User** | 60 | 所有账户的默认层级 |
| **Partner** | 300 | 针对集成合作伙伴 |
| **VIP** | 1,000 | 高用量用户 |

<Note>
  速率限制可能会有所变动。请联系 support@lemondata.cc 以获取自定义限制。
</Note>

## 速率限制标头

每个 API 响应都包含速率限制信息：

```
X-RateLimit-Limit: 60          # Your limit per minute
X-RateLimit-Remaining: 55      # Requests remaining
X-RateLimit-Reset: 1234567890  # Unix timestamp when limit resets
```

## 已超出速率限制

当您超出限制时，您将收到 `429` 响应：

```json
{
  "error": {
    "message": "Rate limit exceeded. Please slow down.",
    "type": "rate_limit_exceeded"
  }
}
```

附带额外标头：
```
Retry-After: 60  # Seconds to wait before retrying
```

## 处理速率限制

### 指数退避 (Exponential Backoff)

实现指数退避以进行自动重试：

```python
import time
from openai import OpenAI, RateLimitError

client = OpenAI(
    api_key="sk-your-api-key",
    base_url="https://api.lemondata.cc/v1"
)

def make_request_with_backoff(messages, max_retries=5):
    for attempt in range(max_retries):
        try:
            return client.chat.completions.create(
                model="gpt-4o",
                messages=messages
            )
        except RateLimitError as e:
            if attempt == max_retries - 1:
                raise

            wait_time = 2 ** attempt  # 1, 2, 4, 8, 16 seconds
            print(f"Rate limited. Waiting {wait_time}s...")
            time.sleep(wait_time)
```

### 请求队列

对于高用量应用程序，请实现请求队列：

```python
import asyncio
from collections import deque

class RateLimitedClient:
    def __init__(self, requests_per_minute=60):
        self.rpm = requests_per_minute
        self.interval = 60 / requests_per_minute
        self.last_request = 0

    async def request(